<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        .popup {
            display: none;
        }

        .popup.open {
            display: block;
        }

        .blocker {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            content: ' ';
            background: rgba(0, 0, 0, .5);
        }

        .popup .contents {
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 200px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #FFF;

            position: fixed;
            top: 50vh;
            left: 50vw;
            transform: translate(-50%, -50%);
        }
    </style>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js"></script>
    <script src="https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js"></script>
    <title>Document</title>
</head>

<body>
    <div id="graph" style="text-align: center;"></div>
    <div class="popup" id="myForm">
        <div class="blocker" onclick="hidePopup()"></div>
        <div class="contents" id="actualpopup">
            This is popup
        </div>
    </div>
    <script>

        var dotSrc = `
        digraph G {
            "('S1', 'O1')" [label="('S1', 'O1')"]
            "('S2', 'O2')" [label="('S2', 'O2')"]
            "('S5', 'O5')" [label="('S5', 'O5')"]
            "('S4', 'O4')" [label="('S4', 'O4')"]
            "('S6', 'O6')" [label="('S6', 'O6')"]
            "('S3', 'O3')" [label="('S3', 'O3')"]
            "('S2', 'O2')" -> "('S1', 'O1')" [label=2 weight=2]
            "('S3', 'O3')" -> "('S1', 'O1')" [label=3 weight=3]
            "('S3', 'O3')" -> "('S2', 'O2')" [label=1 weight=1]
            "('S4', 'O4')" -> "('S2', 'O2')" [label=1 weight=1]
            "('S5', 'O5')" -> "('S2', 'O2')" [label=1 weight=1]
            "('S6', 'O6')" -> "('S5', 'O5')" [label=1 weight=1]
        }
        `;

        const DATA = {
            "('S1', 'O1')": [3, 0, 3, 0, {
                "('S2', 'O2')": 2,
                "('S3', 'O3')": 3
            }
            ],
            "('S2', 'O2')": [2, 0, 2, 0, {
                "('S3', 'O3')": 1,
                "('S4', 'O4')": 1,
                "('S5', 'O5')": 1
            }
            ],
            "('S5', 'O5')": [1, 0, 1, 0, {
                "('S6', 'O6')": 1
            }
            ],
            "('S4', 'O4')": [0, 0, 0, 1, {}
            ],
            "('S6', 'O6')": [0, 0, 0, 1, {}
            ],
            "('S3', 'O3')": [0, 0, 0, 4, {}
            ]
        };




        var dotSrcLines;

        var graphviz = d3.select("#graph").graphviz();

        function render() {
            console.log('DOT source =', dotSrc);
            dotSrcLines = dotSrc.split('\n');

            graphviz
                .transition(function () {
                    return d3.transition()
                        .delay(100)
                        .duration(1000);
                })
                .renderDot(dotSrc)
                .on("end", displayPopupOnClickingNodes);
        }



        function interactive() {

            nodes = d3.selectAll('.node,.edge');
            nodes
                .on("click", function () {
                    alert(data);
                    var title = d3.select(this).selectAll('title').text().trim();
                    var text = d3.select(this).selectAll('text').text();
                    var id = d3.select(this).attr('id');
                    var class1 = d3.select(this).attr('class');
                    dotElement = title.replace('->', ' -> ');
                    console.log('Element id="%s" class="%s" title="%s" text="%s" dotElement="%s"', id, class1, title, text, dotElement);
                    console.log('Finding and deleting references to %s "%s" from the DOT source', class1, dotElement);
                    for (i = 0; i < dotSrcLines.length;) {
                        if (dotSrcLines[i].indexOf(dotElement) >= 0) {
                            console.log('Deleting line %d: %s', i, dotSrcLines[i]);
                            dotSrcLines.splice(i, 1);
                        } else {
                            i++;
                        }
                    }
                    dotSrc = dotSrcLines.join('\n');
                    render();
                });
        }

        function displayPopupOnClickingNodes() {
            nodes = d3.selectAll('.node');
            nodes.on("click", function () {
                const title = d3.select(this).selectAll('title').text();
                showPopup(title);
            })
        }

        render(dotSrc);

        const popup = document.querySelector('.popup');
        function showPopup(title) {
            var popup_contents = document.getElementById('actualpopup');
            popup_contents.innerHTML = [DATA[title][0], DATA[title][1], DATA[title][2], DATA[title][3]];
            popup.classList.add('open');
        }
        function hidePopup() {
            popup.classList.remove('open');
        }



    </script>
</body>

</html>